# Authentication & User Management Testing

## Module Overview

The Authentication & User Management module is the foundation of the Shepherd Church Management System, providing secure access control and user session management. This module includes magic link authentication, QR-based registration, role-based access control, and session management.

### Key Components
- **Magic Link Authentication**: Passwordless login via email
- **QR Registration System**: Token-based member onboarding
- **Role-Based Access Control**: Admin, Pastor, Member permissions
- **Session Management**: Secure login persistence and logout
- **User Profile Management**: Basic profile information and preferences

### Security Features
- **Firebase Authentication**: Industry-standard auth provider
- **Firestore Security Rules**: Database-level access control
- **Role-Based Permissions**: Feature access based on user role
- **Secure Session Management**: Automatic session handling

## Test Scenarios

### TS-AUTH-001: Magic Link Authentication Flow

**Objective**: Verify magic link authentication works correctly from start to finish

**Preconditions**: 
- User has an account in the system
- Email delivery is functional
- User is not currently logged in

**Test Steps**:
1. Navigate to the login page (`/login`)
2. Click "Sign in with Magic Link" or similar option
3. Enter a valid email address (e.g., `admin@test.com`)
4. Click "Send Magic Link" button
5. Check for email delivery confirmation message
6. Open the magic link email (check inbox/spam)
7. Click the magic link in the email
8. Verify redirection to the application
9. Confirm user is logged in and dashboard is accessible

**Expected Results**:
- Email sent confirmation displays
- Magic link email received within 30 seconds
- Magic link redirects to application dashboard
- User session is established
- Navigation shows user name and role
- Dashboard displays user-appropriate content

**Test Data**:
- Valid email: `john.smith@email.com`
- Invalid email: `nonexistent@test.com`
- Malformed email: `invalid-email-format`

**Pass Criteria**: User successfully logs in via magic link without errors

---

### TS-AUTH-002: QR Registration Token Validation

**Objective**: Verify QR registration system validates tokens and creates accounts correctly

**Preconditions**:
- Admin has created a registration token
- QR registration page is accessible
- Token is active and unused

**Test Steps**:
1. Navigate to QR registration page (`/register/qr`)
2. Enter a valid registration token
3. Click "Validate Token" or submit button
4. Verify token validation success message
5. Complete user registration form with:
   - First Name: "Test"
   - Last Name: "User"
   - Email: "testuser@example.com"
   - Phone: "555-123-4567"
6. Select or create household assignment
7. Submit registration form
8. Verify account creation success
9. Attempt to log in with new account

**Expected Results**:
- Token validates successfully
- Registration form displays
- All required fields validate properly
- Household assignment options available
- Account creation completes without errors
- New user can log in immediately
- User has appropriate default role (Member)

**Test Data**:
- Valid token: [Generated by admin]
- Invalid token: `INVALID-TOKEN-123`
- Expired token: [Expired token if available]
- Used token: [Previously used token]

**Pass Criteria**: New account created successfully via QR token registration

---

### TS-AUTH-003: Role-Based Access Control - Admin Role

**Objective**: Verify admin role has appropriate access to all system features

**Preconditions**:
- Admin user account exists (`admin@test.com`)
- User is logged in with admin role

**Test Steps**:
1. Log in as admin user
2. Verify dashboard displays admin-specific features
3. Check navigation menu includes all items:
   - Dashboard
   - Members
   - Households
   - Events
   - Donations
   - Reports
   - Sermons
   - Volunteers
   - My Schedule
   - Settings
4. Navigate to each menu item and verify access
5. Test admin-specific functions:
   - Create new member
   - Manage donations
   - Access financial reports
   - Modify system settings
6. Verify quick action buttons on dashboard
7. Test member management capabilities

**Expected Results**:
- All navigation items visible and accessible
- Admin-specific features available
- Financial data and reports accessible
- Member creation and management allowed
- System settings accessible
- No access denied errors

**Test Data**:
- Admin credentials: `john.smith@email.com` (use password reset to set password)

**Pass Criteria**: Admin role has full system access without restrictions

---

### TS-AUTH-004: Role-Based Access Control - Pastor Role

**Objective**: Verify pastor role has appropriate ministry-focused access

**Preconditions**:
- Pastor user account exists (`pastor@test.com`)
- User is logged in with pastor role

**Test Steps**:
1. Log in as pastor user
2. Verify dashboard displays pastor-appropriate features
3. Check navigation menu includes:
   - Dashboard
   - Members
   - Households
   - Events
   - Donations
   - Reports
   - Sermons
   - Volunteers
   - My Schedule
4. Verify pastor-specific access:
   - Can create and manage events
   - Can upload sermons
   - Can access donations and reports
   - Can manage volunteer scheduling
5. Verify restricted access:
   - Cannot access system settings
   - Cannot modify user roles (if applicable)
6. Test ministry workflow capabilities

**Expected Results**:
- Ministry-focused navigation items available
- Can create events and upload sermons
- Has access to donations and reporting
- Cannot access admin-only features
- Ministry workflow functions properly

**Test Data**:
- Pastor credentials: `michael.johnson@email.com` (use password reset to set password)

**Pass Criteria**: Pastor role has ministry access without admin privileges

---

### TS-AUTH-005: Role-Based Access Control - Member Role

**Objective**: Verify member role has limited, appropriate access to community features

**Preconditions**:
- Member user account exists (`member@test.com`)
- User is logged in with member role

**Test Steps**:
1. Log in as member user
2. Verify dashboard displays member-appropriate content
3. Check navigation menu includes only:
   - Dashboard
   - Members (view only)
   - Households (view only)
   - Events
   - Sermons
   - Volunteers
   - My Schedule
4. Test member-specific access:
   - Can view member directory
   - Can RSVP to events
   - Can access sermon archive
   - Can sign up for volunteer opportunities
   - Can view own schedule
5. Verify restricted access:
   - Cannot create/edit members
   - Cannot access donations/reports
   - Cannot create events
   - Cannot upload sermons
   - Cannot access admin features

**Expected Results**:
- Limited navigation menu appropriate for members
- Can participate in community activities
- Cannot access administrative functions
- Cannot modify other users' data
- Self-service features work properly

**Test Data**:
- Member credentials: `sarah.smith@email.com` (use password reset to set password)

**Pass Criteria**: Member role has community access without administrative privileges

---

### TS-AUTH-006: Session Management and Security

**Objective**: Verify secure session handling, persistence, and logout functionality

**Preconditions**:
- User account exists and is logged out
- Browser cookies/storage clear

**Test Steps**:
1. Log in with valid credentials
2. Navigate to different pages within the application
3. Refresh the browser page
4. Verify user remains logged in
5. Close browser tab and reopen application
6. Verify session persistence (if configured)
7. Let session idle for extended period (if timeout configured)
8. Click logout button
9. Verify complete logout:
   - Redirected to login page
   - Cannot access protected pages without re-authentication
   - User data cleared from browser session
10. Attempt to access protected URL directly
11. Verify redirect to login page

**Expected Results**:
- Session persists across page refreshes
- Session persists across browser tab closure (if configured)
- Session timeout works properly (if configured)
- Logout clears session completely
- Protected pages require re-authentication after logout
- Direct URL access redirects to login when not authenticated

**Test Data**:
- Any valid user credentials

**Pass Criteria**: Session management works securely and reliably

---

### TS-AUTH-007: Invalid Authentication Attempts

**Objective**: Verify system properly handles invalid login attempts and security measures

**Preconditions**:
- System is accessible
- No active user session

**Test Steps**:
1. Attempt login with invalid email format
2. Attempt login with non-existent email
3. Attempt login with valid email but wrong password
4. Attempt multiple failed logins rapidly
5. Try to access protected URLs without authentication
6. Test magic link with expired/invalid token
7. Test QR registration with invalid tokens
8. Verify error messages are clear and helpful
9. Check for rate limiting or security measures

**Expected Results**:
- Clear error messages for invalid inputs
- Non-existent accounts handled gracefully
- Invalid passwords rejected with appropriate message
- Rate limiting prevents brute force attempts (if implemented)
- Unauthorized access redirects to login
- Expired/invalid tokens rejected properly
- Security measures don't reveal sensitive information

**Test Data**:
- Invalid emails: `notanemail`, `@domain.com`, `user@`
- Non-existent email: `nonexistent@test.com`
- Wrong password: `wrongpassword123`

**Pass Criteria**: Invalid attempts handled securely with clear feedback

---

### TS-AUTH-008: Cross-Browser Authentication Compatibility

**Objective**: Verify authentication works consistently across different browsers

**Preconditions**:
- Multiple browsers available (Chrome, Firefox, Safari, Edge)
- User account exists

**Test Steps**:
1. Test magic link authentication in Chrome
2. Test magic link authentication in Firefox
3. Test magic link authentication in Safari (if available)
4. Test magic link authentication in Edge (if available)
5. Verify session persistence in each browser
6. Test logout functionality in each browser
7. Verify UI displays correctly in each browser
8. Test QR registration in multiple browsers

**Expected Results**:
- Authentication works in all tested browsers
- Session management consistent across browsers
- UI displays properly in all browsers
- No browser-specific errors or issues
- Feature parity across browser platforms

**Test Data**:
- Standard test credentials for each browser

**Pass Criteria**: Authentication functions consistently across all tested browsers

---

### TS-AUTH-009: Mobile Authentication Experience

**Objective**: Verify authentication works properly on mobile devices

**Preconditions**:
- Mobile device or browser simulation available
- User account exists

**Test Steps**:
1. Access login page on mobile device
2. Test magic link authentication on mobile
3. Verify email client integration works
4. Test QR code scanning (if QR scanner available)
5. Verify mobile layout and usability
6. Test touch interactions and form inputs
7. Verify session persistence on mobile
8. Test logout functionality on mobile

**Expected Results**:
- Login page displays properly on mobile
- Magic link works from mobile email clients
- QR code scanning functions properly
- Touch interactions work smoothly
- Form inputs are accessible and functional
- Session management works on mobile
- Mobile UI is intuitive and functional

**Test Data**:
- Standard test credentials
- Mobile browser or actual mobile device

**Pass Criteria**: Authentication fully functional on mobile platforms

---

### TS-AUTH-010: Authentication Error Recovery

**Objective**: Verify users can recover from authentication errors and edge cases

**Preconditions**:
- Various error conditions can be simulated
- User account exists

**Test Steps**:
1. Simulate network interruption during magic link request
2. Test recovery from failed magic link delivery
3. Attempt authentication with browser cookies disabled
4. Test authentication with JavaScript disabled
5. Simulate session timeout during activity
6. Test recovery from corrupted session data
7. Verify "forgot password" or account recovery options
8. Test authentication after account status changes

**Expected Results**:
- Clear error messages for network issues
- Options to retry failed operations
- Graceful degradation when features unavailable
- Session timeout handled with appropriate redirect
- Account recovery options available
- Status changes reflected in authentication

**Test Data**:
- Standard test credentials
- Simulated error conditions

**Pass Criteria**: System recovers gracefully from authentication errors

---

## Cross-Module Integration Tests

### TS-AUTH-INT-001: Authentication to Dashboard Flow
**Objective**: Verify seamless transition from authentication to dashboard
- Login successful → Dashboard loads → User data displays → Navigation functional

### TS-AUTH-INT-002: Role-Based Feature Access
**Objective**: Verify role permissions integrate with all modules
- Admin login → All features accessible
- Pastor login → Ministry features accessible
- Member login → Community features accessible

### TS-AUTH-INT-003: Session Persistence Across Modules
**Objective**: Verify session maintains across different application sections
- Login → Navigate through all modules → Session persists → Data access consistent

## Performance Benchmarks

- **Magic Link Delivery**: < 30 seconds
- **Login Redirect**: < 2 seconds
- **Session Validation**: < 500ms
- **Role Permission Check**: < 200ms
- **Logout Process**: < 1 second

## Security Considerations

- **Password Handling**: No passwords stored in browser
- **Session Tokens**: Secure token management
- **Role Enforcement**: Database-level security (RLS)
- **Data Protection**: User data access restricted by role
- **Session Security**: Automatic timeout and secure logout

## Common Issues and Solutions

### Magic Link Not Received
- **Check**: Spam/junk folder
- **Verify**: Email address spelling
- **Action**: Request new magic link

### Session Expires Quickly
- **Check**: Browser privacy settings
- **Verify**: Cookie settings enabled
- **Action**: Adjust browser settings

### Role Access Issues
- **Check**: User role assignment
- **Verify**: Database permissions
- **Action**: Contact administrator

---

**Module Testing Status**: ⚠️ In Progress  
**Last Updated**: July 17, 2025  
**Critical Test Count**: 10  
**Integration Test Count**: 3  
**Estimated Testing Time**: 4-6 hours